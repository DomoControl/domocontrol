<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Domus Control</title>
    <link href="./css/style.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="/webiopi.js"></script>
    <script type="text/javascript"> 
        
        //Funzione che trasforma i cookie in array
        function getCookies() {
            var cookies = { }; 
            if (document.cookie && document.cookie != '') {
                var split = document.cookie.split(';');
                for (var i = 0; i < split.length; i++) {
                    var name_value = split[i].split("=");
                    name_value[0] = name_value[0].replace(/^ /, '');
                    cookies[decodeURIComponent(name_value[0])] = decodeURIComponent(name_value[1]);
                }
            }	 
            return cookies;   
        }       
        
        
        //Ciclo principale
        webiopi().ready(
            function() {
                var aa = {'aa':'bb'};
                //document.cookie="username=John";
                //document.cookie="piLogin=True";

                //per eliminare un cookie
                //document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 UTC"; 
                //alert(document.cookie);
                //alert(getCookies()['username'] + getCookies()["piLogin"]);    
                
                if (getCookies() && getCookies()["username"] && getCookies()["piLogin"]) {
                    $("#form").append("Benvenuto " + getCookies()["username"] ) ;
                    
                    $("#form").append('<p><a href="/status.html">IO Status</a></p>');
                    $("#form").append('<p><a href="/setup.html">Setup</a></p>');
                }
                else {
                    var l = '<form style="border: 1px solid green; padding: 10px; margin: 10px;" id="login">' + 
                             '<center>Username: <input id="username" type=text name="username" value="" required autofocus placeholder="Username" > </center>' +
                                '<center>Password: <input id="password" type=password name="password" value="" required placeholder="Password"></center>' +
                                '<center><input id="entra" type="button" name="entra" value="Entra" onclick=Login("Login()");></center>' +
                            '</form>';
                    $("#form").append(l);
                }
                
                
                $("#footer").append(Footer());
                
                webiopi().refreshGPIO(false);
            });
            // Fine main ciclo
            
            //verifica se le credenziali sono corrette
            function Login() {
                var username = $("#username").val();
                var password = $("#password").val();
                if($("#entra").val()=="Entra" && username && password) {
                    //alert("bisogna inviare le credenziali traite una macro a python per la verifica");
                    if(username == "luca" && password == "12311") {
                        document.cookie="username=luca";
                        document.cookie="piLogin=True";
                        location.reload();
                    }
                    
                    
                }
            }
            
            function LogOut() {
                document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
                document.cookie = "piLogin=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
                location.reload();
            }
            
            //Contenuto del footer
            function Footer() {
                var footer = ' <input type="button" name="footer" value="LogOut" onclick=LogOut("LogOut()") >' ;
                return footer;
            }

    </script> 
</head>
<body>


<div id="container">
    <div class="title">DomoControl Main</div>
    <div id="user"></div>
    
    <div id="login">

    </div>
    
    <div id="pages"></div>
    <div id="form"></div>
    <div id="menu"></div>
    <div id="message"></div>
    <div id="footer"></div>
    

</div>




</body>
</html>
